<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
	<Product Id="*" Name="!(loc.ApplicationTitle)" Language="1033" Version="01.006.010.1" Manufacturer="!(loc.ManufacturerName)" UpgradeCode="87c8aa64-1a84-4767-ae17-a4b6b6ee1b89">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />
    <Media Id="1" Cabinet="SEToolbox.cab" EmbedCab="yes" />

		<!--<WixVariable Id="WixUIBannerBmp" Value="WixUIBannerBmp.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="WixUIDialogBmp.bmp" />-->

    <MajorUpgrade DowngradeErrorMessage="A newer version of !(loc.ProductName) is already installed." />

    <Feature Id="ProductFeature" Title="!(loc.DirApplicationName)" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>

    <Icon Id="APPLICATIONICON" SourceFile="app.ico"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="COMPANYFOLDER" Name="!(loc.DirCompanyName)">
          <Directory Id="APPLICATIONFOLDER" Name="!(loc.DirApplicationName)">
            <Component Id="UninstallAppFolder" Guid="6AF1643F-8251-4FAE-A2AF-F3BB96FC931A">
              <CreateFolder />
              <RemoveFile Id="PurgeAppFolder" Name="*.*" On="uninstall" />
            </Component>
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="COMPANYPROGRAMFOLDER" Name="!(loc.DirCompanyName)">
          <Directory Id="ApplicationProgramsFolder" Name="!(loc.DirApplicationName)"/>
        </Directory>
      </Directory>
    </Directory>

    <!-- UI -->
    <!--<UIRef Id="WixUI_InstallDir" />-->

    <!--<UIRef Id="WixUI_CustomInstallDir" />-->
    <UIRef Id="WixUI_ErrorProgressText" />
    <Property Id="WIXUI_INSTALLDIR" Value="APPLICATIONFOLDER" />
    <Property Id="ARPPRODUCTICON" Value="APPLICATIONICON" />

    <!-- Install properties. Override these in the msiexec install for unattended install. -->
    <!--<Property Id="WIXUI_SERVERNAME" Value="SERVERNAME" />
    <Property Id="WIXUI_SERVERPORT" Value="30000" />-->

    <!-- All Files, except the .config -->
    <ComponentGroup Id="ProductComponents" Directory="APPLICATIONFOLDER">
      <Component Id="comp2EA1FC447B50410DA2CE55F182C0E00C">
        <File Id="file184705D6F44643D48E157FDD3FBF37D7" Source="$(var.SEToolbox.TargetDir)SEToolbox.exe" Checksum="yes"/>
      </Component>
      <Component Id="comp971B9491681C49D5827078EAA03C7894">
        <File Id="file231E559E7FD14DDD9FD7DF0958D6D2A9" Source="$(var.SEToolbox.TargetDir)poly2vox.exe"/>
      </Component>
      <Component Id="comp88066F31283E44A79F1D679F4B9D80AE">
        <File Id="file61275B9FC2AE484BA7A2BDB7459A3647" Source="$(var.SEToolbox.TargetDir)Sandbox.CommonLib.dll"/>
      </Component>
      <Component Id="compB0198B4AB39348F5B20741B39BD36F84">
        <File Id="file7EFAAE0C91A74E6D9BB6541C081E757C" Source="$(var.SEToolbox.TargetDir)Sandbox.CommonLib.XmlSerializers.dll"/>
      </Component>
      <Component Id="compD92E196604CA4CDBB739699BCB446CAE">
        <File Id="fileA1ED1B028B6F45868D48799D4DDE0D94" Source="$(var.SEToolbox.TargetDir)SEToolbox.ImageLibrary.dll"/>
      </Component>
      <Component Id="comp4FF0A2172F244A5FA36AE80475BE0F8E">
        <File Id="file97FBC095E9A34E86AA664F4C5C9967B7" Source="$(var.SEToolbox.TargetDir)System.Windows.Interactivity.dll"/>
      </Component>
      <Component Id="comp8C20AE654FFF46DA894F7056064AA6EF">
        <File Id="fileDE67BBEC95CE4178B5B7A4AE5101E6FC" Source="$(var.SEToolbox.TargetDir)VRage.Common.dll"/>
      </Component>
      <Component Id="comp826C90B9476943B8B8114031A01913F1">
        <File Id="file3B25B4B8D8824BFBBC59FF95EB66E88F" Source="$(var.SEToolbox.TargetDir)VRage.Library.dll"/>
      </Component>
      <Component Id="compD71C446C9E204CD7A003FA06132E67BE">
        <File Id="file97E0990BBDDF40A68ED535BF1D64AF8E" Source="$(var.SEToolbox.TargetDir)VRage.Math.dll"/>
      </Component>
    </ComponentGroup>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut">
        <!-- Application shortcut -->
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="!(loc.ShortcutName)"
                  Description="!(loc.ShortcutDescription)"
                  Target="[APPLICATIONFOLDER]SEToolbox.exe"
                  WorkingDirectory="APPLICATIONFOLDER"/>
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
        <RemoveFolder Id="RemoveProgramMenuDir" Directory='COMPANYPROGRAMFOLDER' On='uninstall' />
        <!-- Application registry -->
        <RegistryValue Root="HKCU" Key="Software\!(loc.DirCompanyName)\!(loc.DirApplicationName)" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Feature Id="MainApplication" Title="Main Application" Level="1">
      <ComponentRef Id="comp2EA1FC447B50410DA2CE55F182C0E00C" />
      <ComponentRef Id="ApplicationShortcut" />
      <!--<ComponentRef Id="UpdateConfig" />-->
      <ComponentRef Id="UninstallAppFolder"/>
    </Feature>

    <!--<InstallExecuteSequence>
      <Custom Action="IsPrivileged" Before="LaunchConditions">
        Not Privileged
      </Custom>

      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWERPRODUCTFOUND</Custom>

      --><!-- Need to schedule this late to avoid uninstalling the service and needing to re-enter log-in details. --><!--
      <RemoveExistingProducts After="InstallFinalize" />
    </InstallExecuteSequence>-->

    <!--<InstallUISequence>
      <Custom Action="IsPrivileged" Before="LaunchConditions">
        Not Privileged
      </Custom>

      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWERPRODUCTFOUND</Custom>
    </InstallUISequence>-->
  </Product>

  <Fragment>
   
    
      <!--<UI Id="WixUI_CustomInstallDir">
      <Dialog Id="ProductServerDlg" Width="370" Height="270" Title="!(loc.ProductServerDlg_Title)">
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="!(loc.InstallDirDlgBannerBitmap)" />
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />
        <Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.ProductServerDlgDescription)" />
        <Control Id="Title" Type="Text" X="15" Y="6" Width="200" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.ProductServerDlgTitle)" />

        <Control Id="EnterServer" Type="Text" Height="16" Width="254" X="20" Y="60" Text="!(loc.ProductServerDlgEnterServer)" />
        <Control Id="Server" Type="Edit" Height="15" Width="140" X="20" Y="100" Property="WIXUI_SERVERNAME" />
        <Control Id="Port" Type="Edit" Height="15" Width="100" X="162" Y="100" Property="WIXUI_SERVERPORT" />

        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)">
          <Publish Event="SpawnWaitDialog" Value="WaitForCostingDlg">!(wix.WixUICostingPopupOptOut) OR CostingComplete = 1</Publish>
          <Condition Action="disable"><![CDATA[WIXUI_SERVERNAME = ""]]></Condition>
          <Condition Action="enable"><![CDATA[WIXUI_SERVERNAME <> ""]]></Condition>
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
      </Dialog>

      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="InstallDir" />

      <DialogRef Id="BrowseDlg" />
      <DialogRef Id="DiskCostDlg" />
      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="UserExit" />

      <Publish Dialog="BrowseDlg" Control="OK" Event="DoAction" Value="WixUIValidatePath" Order="3">1</Publish>
      <Publish Dialog="BrowseDlg" Control="OK" Event="SpawnDialog" Value="InvalidDirDlg" Order="4"><![CDATA[WIXUI_INSTALLDIR_VALID<>"1"]]></Publish>

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg">NOT Installed</Publish>
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg">Installed AND PATCH</Publish>

      <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish>
      <Publish Dialog="LicenseAgreementDlg" Control="Next" Event="NewDialog" Value="ProductServerDlg">LicenseAccepted = "1"</Publish>

      <Publish Dialog="ProductServerDlg" Control="Back" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
      <Publish Dialog="ProductServerDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg"><![CDATA[WIXUI_SERVERNAME <> ""]]></Publish>
      
      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="ProductServerDlg">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="SetTargetPath" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="DoAction" Value="WixUIValidatePath" Order="2">NOT WIXUI_DONTVALIDATEPATH</Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="SpawnDialog" Value="InvalidDirDlg" Order="3"><![CDATA[NOT WIXUI_DONTVALIDATEPATH AND WIXUI_INSTALLDIR_VALID<>"1"]]></Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg" Order="4">WIXUI_DONTVALIDATEPATH OR WIXUI_INSTALLDIR_VALID="1"</Publish>
      <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Property="_BrowseProperty" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Event="SpawnDialog" Value="BrowseDlg" Order="2">1</Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="InstallDirDlg" Order="1">NOT Installed</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg" Order="2">Installed AND NOT PATCH</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2">Installed AND PATCH</Publish>

      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>

      <Property Id="ARPNOMODIFY" Value="1" />
    </UI>-->

    <!--<UI>
      <Dialog Id="AssistanceOptionsDlg" Width="370" Height="270" Title="!(loc.AssistanceOptionsDlg_Title)">
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)">
          <Publish Event="NewDialog" Value="[WixUI_AssistanceOptionsDlg_Next]">1</Publish>
          <Publish Property="ALLUSERS" Value="{}">ASSISTANCE_USERS="cur"</Publish>
          <Publish Property="ALLUSERS" Value="1">ASSISTANCE_USERS="all"</Publish>
        </Control>
        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)">
          <Publish Event="NewDialog" Value="[WixUI_AssistanceOptionsDlg_Back]">1</Publish>
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>

        <Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.AssistanceOptionsDlgDescription)" />
        <Control Id="Title" Type="Text" X="15" Y="6" Width="200" Height="15" Transparent="yes" NoPrefix="yes" Text="!(loc.AssistanceOptionsDlgTitle)" />
        <Control Id="BannerBitmap" Type="Bitmap" X="0" Y="0" Width="370" Height="44" TabSkip="no" Text="!(loc.AssistanceOptionsDlgBannerBitmap)" />
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />

        <Control Id="UserText1" Type="Text" X="20" Y="60" Width="330" Height="35"
             Text="!(loc.AssistanceOptionsDlgUserText1)" />
        <Control Id="UserText2" Type="Text" X="20" Y="95" Width="330" Height="20"
           Text="!(loc.AssistanceOptionsDlgUserText2)" />
        <Control Id="UserSelection" Type="RadioButtonGroup"
          X="26" Y="115" Width="305" Height="45" Property="ASSISTANCE_USERS"
          Text="ASSISTANCE_USERS">
          <RadioButtonGroup Property="ASSISTANCE_USERS">
            <RadioButton Value="cur" X="0" Y="0" Width="295" Height="16"
                   Text="!(loc.AssistanceOptionsDlgRBOneUser)" />
            <RadioButton Value="all" X="0" Y="20" Width="295" Height="16"
                   Text="!(loc.AssistanceOptionsDlgRBAllUsers)" />
          </RadioButtonGroup>
        </Control>

        <Control Id="SplitLine" Type="Line" X="0" Y="160" Width="370" Height="0" />
        <Control Id="ShortcutDesktop" Type="CheckBox" Height="18" Width="295" X="40" Y="170"
             Text="!(loc.AssistanceOptionsDlgShortcutDesktop)"
             Property="ASSISTANCE_SHORTCUT_DESKTOP" CheckBoxValue="1" Disabled="yes" />
        <Control Id="ShortcutProgramMenu" Type="CheckBox" Height="18" Width="295" X="40" Y="190"
             Text="!(loc.AssistanceOptionsDlgShortcutProgramMenu)" Disabled="yes"
             Property="ASSISTANCE_SHORTCUT_PROGRAMMENU" CheckBoxValue="1" />
        <Control Id="ShortcutStartup" Type="CheckBox" Height="18" Width="295" X="40" Y="210"
             Text="!(loc.AssistanceOptionsDlgShortcutStartup)" Disabled="yes"
             Property="ASSISTANCE_SHORTCUT_STARTUP" CheckBoxValue="1" />

      </Dialog>
    </UI>-->
    
    <!--<UIRef Id="WixUI_Common" />-->
    
  </Fragment>
</Wix>